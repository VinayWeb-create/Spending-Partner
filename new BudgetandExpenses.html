
    <!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Spending Partner - Dashboard</title>

  <!-- Bootstrap & Font Awesome -->
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet"/>
  <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css" rel="stylesheet"/>

  <style>
    body {
      font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
      background: linear-gradient(135deg, #A8E063, #4F8A10);
      color:  green;
      min-height: 100vh;
    }

    .container-custom {
      background: #ffffff;
      border-radius: 12px;
      box-shadow: 0 10px 30px rgba(0, 0, 0, 0.1);
      padding: 40px;
      max-width: 1000px;
      margin: 60px auto;
      transition: all 0.3s ease;
    }

    .container-custom:hover {
      transform: translateY(-10px);
      
    }

    .btn-custom {
      background: #4CAF50;
      color: white;
      transition: 0.3s;
    }

    .btn-custom:hover {
      background: #388E3C;
      color: #fff;
    }

    .form-control {
      border-radius: 8px;
      box-shadow: inset 0 1px 3px rgba(0, 0, 0, 0.1);
    }

    .transaction-item {
      background: #f1f1f1;
      padding: 15px;
      border-radius: 8px;
      box-shadow: 0 4px 10px rgba(0, 0, 0, 0.1);
      transition: 0.3s;
    }

    .transaction-item:hover {
      background: #e0e0e0;
    }

    .chart-btn {
      position: fixed;
      bottom: 20px;
      right: 20px;
      background-color: #4CAF50;
      color: white;
      font-size: 22px;
      width: 60px;
      height: 60px;
      border: none;
      border-radius: 50%;
      cursor: pointer;
      box-shadow: 2px 2px 15px rgba(0, 0, 0, 0.2);
      transition: background-color 0.3s;
      z-index: 1000;
    }

    .chart-btn:hover {
      background-color: #388E3C;
    }

    .floating-btn-left {
      position: fixed;
      bottom: 20px;
      left: 20px;
      background: #ffc107;
      color: #fff;
      font-size: 22px;
      width: 60px;
      height: 60px;
      border: none;
      border-radius: 50%;
      cursor: pointer;
      box-shadow: 0 4px 15px rgba(0, 0, 0, 0.2);
      transition: background-color 0.3s, transform 0.3s;
      z-index: 1000;
    }

    .floating-btn-left:hover {
      background: #ffca28;
      transform: scale(1.1);
    }

    .delete-button {
      background-color: #e74c3c;
      color: white;
      border: none;
      padding: 10px 20px;
      border-radius: 5px;
      font-size: 14px;
      cursor: pointer;
      transition: background-color 0.3s ease;
    }

    .delete-button:hover {
      background-color: #c0392b;
    }

    .delete-button:disabled {
      background-color: #aaa;
      cursor: not-allowed;
    }
  </style>
</head>
<body>

<!-- Navbar -->
<nav class="navbar navbar-expand-lg navbar-dark bg-dark">
  <div class="container-fluid">
     <marquee behavior="scroll" direction="left" scrollamount="5"><h1>üíº Spending Partner - Manage Smarter, Live Better</h1></marquee>
    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarNav">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div class="collapse navbar-collapse justify-content-end" id="navbarNav">
      <ul class="navbar-nav">
        <li class="nav-item">
          <a class="nav-link btn btn-warning text-dark mx-1" href="new setting.html">Settings</a>
        </li>
        <li class="nav-item">
          <a class="nav-link btn btn-danger text-white mx-1" href="alert-settings.html">Alert</a>
        </li>
        <li class="nav-item">
          <a class="nav-link btn btn-info text-white mx-1" href="budget_chart.html">Chart</a>
        </li>
      <!--
        <li class="nav-item">
          <button class="nav-link btn btn-primary text-white mx-1" onclick="openEditModal()">Edit Budget</button>
        </li>
        <li class="nav-item">
          <button class="nav-link btn btn-danger text-white mx-1" onclick="deleteBudget('123')">Delete</button>
        </li>
        -->
      </ul>
    </div>
  </div>
</nav>


<!-- Content -->
<div class="container-custom">
  <h1 class="text-center text-success mb-4">
    <i class="fas fa-wallet"></i> Finance Manager
  </h1>

  <!-- Budget Form -->
  <div class="mb-4">
    <h4>Set Your Budget</h4>
    <form class="row g-3">
      <div class="col-md-4"><input type="text" id="budgetName" class="form-control" placeholder="Budget Name" /></div>
      <div class="col-md-4"><input type="number" id="budgetAmount" class="form-control" placeholder="Amount (‚Çπ)" /></div>
      <div class="col-md-4">
        <select id="timePeriod" class="form-select">
          <option value="day">Day</option><option value="week">Week</option>
          <option value="month">Month</option><option value="year">Year</option>
        </select>
      </div>
      <div class="col-12"><button type="button" class="btn btn-custom w-100" onclick="saveBudget()">Save Budget</button></div>
    </form>
  </div>

  <!-- Summary -->
  <div class="bg-light p-4 rounded-3 shadow-sm">
    <h4>Current Budget</h4>
    <p><strong>Amount:</strong> ‚Çπ<span id="currentBudget">0</span></p>
    <p><strong>Remaining:</strong> ‚Çπ<span id="remainingBudget">0</span></p>
  </div>

  <!-- Dropdown -->
  <div class="mt-4">
    <label for="budgetSelector"><strong>Select Budget:</strong></label>
    <select id="budgetSelector" class="form-select" onchange="loadBudget()"></select>
  </div>

  <!-- Transactions -->
  <div class="d-flex justify-content-between mt-4">
    <button id="viewTransactionsBtn" class="btn btn-primary" onclick="togglePreviousBudgets()">View Transactions</button>
  </div>
  <div id="previousBudgetsList" class="mt-4" style="display: none;"></div>
  <div id="transactionsList" class="mt-4" style="display: none;"></div>

  <!-- Add Expense -->
  <div id="expenses" class="mt-5">
    <h4>Add Expense</h4>
    <form class="row g-3">
      <div class="col-md-6"><input type="number" id="expenseAmount" class="form-control" placeholder="Expense Amount (‚Çπ)" /></div>
      <div class="col-md-6"><input type="text" id="expenseDescription" class="form-control" placeholder="Expense Description" /></div>
      <div class="col-12"><button type="button" class="btn btn-danger w-100" onclick="addExpense()">Add Expense</button></div>
    </form>
  </div>
</div>

<!-- Chart Button -->
<button onclick="location.href='budget_chart.html'" class="chart-btn"><i class="fas fa-chart-pie"></i></button>

<!-- Floating Edit Button 
<button class="floating-btn-left" onclick="openEditModal()"><i class="fas fa-edit"></i></button>
-->
<!-- Bootstrap JS -->
<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>

</body>
</html>


<script>
// ‚úÖ 1. Global Variables (Define at the top)
let previousBudgets = [];
let selectedBudgetIndex = null;
let transactionsVisible = false;   // üëà Add this here
let budgetsVisible = false;        // üëà Add this here

// ‚úÖ 2. Load Budgets When Page Loads
window.onload = () => {
    fetchBudgetsFromServer();
};


        
// ‚úÖ Save Budget Function
async function saveBudget() {
    const budgetName = document.getElementById("budgetName").value.trim();
    const budgetAmount = parseFloat(document.getElementById("budgetAmount").value);
    const timePeriod = document.getElementById("timePeriod").value;

    if (!budgetName || isNaN(budgetAmount) || budgetAmount <= 0 || !timePeriod) {
        alert("‚ùå Please enter valid budget details.");
        return;
    }

    // ‚úÖ Include the user ID (retrieved from session or localStorage)
    const userId = localStorage.getItem("user_id");  // Retrieve user_id from localStorage or session
    if (!userId) {
        alert("‚ùå User ID missing. Please log in.");
        return;
    }

    const budgetData = {
        user_id: userId,                   // ‚úÖ Include user_id
        name: budgetName,
        amount: budgetAmount.toFixed(2),   // Format to 2 decimal places
        time_period: timePeriod
    };

    console.log("üì§ Sending Data:", budgetData);  // ‚úÖ Debugging

    try {
        const response = await fetch("save_budget.php", {
            method: "POST",
            headers: {
                "Content-Type": "application/json"
            },
            body: JSON.stringify(budgetData)
        });

        const data = await response.json();
        console.log("‚úÖ Server Response:", data);  // ‚úÖ Debugging

        if (data.status === "success") {
            alert("‚úÖ Budget saved successfully!");
            fetchBudgetsFromServer();   // Reload budgets
            clearInputs(["budgetName", "budgetAmount"]);
            document.getElementById("timePeriod").value = "day";
        } else {
            alert(`‚ùå Error: ${data.message}`);
        }

    } catch (error) {
        console.error("‚ùå Error saving budget:", error);
        alert("‚ùå Failed to connect to the server.");
    }
}
// ‚úÖ Open Edit Modal
function openEditModal(id = '', name = '', amount = '', timePeriod = '') {
    document.getElementById("editBudgetId").value = id;
    document.getElementById("editBudgetName").value = name || '';
    document.getElementById("editBudgetAmount").value = amount || '';
    document.getElementById("editTimePeriod").value = timePeriod || 'month';

    // Show the modal
    new bootstrap.Modal(document.getElementById('budgetModal')).show();
}

async function saveEditedBudget() {
    const id = document.getElementById("editBudgetId").value;
    const name = document.getElementById("editBudgetName").value;
    const amount = parseFloat(document.getElementById("editBudgetAmount").value);
    const timePeriod = document.getElementById("editTimePeriod").value;

    if (!id || !name || isNaN(amount) || amount <= 0 || !timePeriod) {
        alert("‚ùå Please enter valid budget details.");
        return;
    }

    // ‚úÖ Use FormData or URL-encoded format
    const formData = new URLSearchParams();
    formData.append("id", id);
    formData.append("name", name);
    formData.append("amount", amount);
    formData.append("time_period", timePeriod);

    console.log("üì§ Sending Data:", formData.toString());

    try {
        const response = await fetch("update_budget.php", {
            method: "POST",
            headers: {
                "Content-Type": "application/x-www-form-urlencoded"  // ‚úÖ URL-encoded header
            },
            body: formData.toString()  // ‚úÖ Send as form-encoded
        });

        const data = await response.json();
        console.log("‚úÖ Server Response:", data);

        if (data.status === "success") {
            alert("‚úÖ Budget updated successfully!");
            fetchBudgetsFromServer();
        } else {
            alert(`‚ùå Error: ${data.message}`);
        }

    } catch (error) {
        console.error("‚ùå Error:", error);
        alert("‚ùå Failed to update budget.");
    }
}


       

// ‚úÖ 4. Fetch Budgets from Server
async function fetchBudgetsFromServer() {
    try {
        const response = await fetch("fetch_budgets.php");
        const budgets = await response.json();

        previousBudgets = budgets;
        updateBudgetDropdown();

        if (budgets.length > 0) {
            loadSelectedBudget(budgets[0].id);
        } else {
            document.getElementById("currentBudget").textContent = "‚Çπ0";
            document.getElementById("remainingBudget").textContent = "‚Çπ0";
        }
    } catch (error) {
        console.error("‚ùå Error fetching budgets:", error);
    }
}

function updateBudgetDropdown() {
    const budgetSelector = document.getElementById("budgetSelector");
    const previousBudgetsList = document.getElementById("previousBudgetsList");

    budgetSelector.innerHTML = "<option value=''>Select a Budget</option>";
    previousBudgetsList.innerHTML = ""; // Clear previous

    previousBudgets.forEach(budget => {
        // Dropdown
        const option = document.createElement("option");
        option.value = budget.id;
        option.textContent = `${budget.name} (‚Çπ${budget.amount})`;
        budgetSelector.appendChild(option);

        // List with delete button
        const div = document.createElement("div");
        div.classList.add("budget-item", "d-flex", "justify-content-between", "align-items-center", "mb-2", "p-2", "border", "rounded");
        div.innerHTML = `
            <div>
                <strong>${budget.name}</strong> - ‚Çπ${budget.amount}
            </div>
              
        `;
        previousBudgetsList.appendChild(div);
    });

    budgetSelector.addEventListener("change", () => loadSelectedBudget(budgetSelector.value));
}


// ‚úÖ 6. Load Selected Budget
function loadSelectedBudget(budgetId) {
    if (!budgetId) {
        document.getElementById("currentBudget").textContent = "‚Çπ0";
        document.getElementById("remainingBudget").textContent = "‚Çπ0";
        return;
    }

    const selectedBudget = previousBudgets.find(budget => budget.id == budgetId);

    if (selectedBudget) {
        document.getElementById("currentBudget").textContent = `‚Çπ${selectedBudget.amount}`;
        document.getElementById("remainingBudget").textContent = `‚Çπ${selectedBudget.remaining_amount}`;

        fetchTransactions(budgetId);
    }
}

// ‚úÖ 7. Add Expense
function addExpense() {
    const expenseAmount = parseFloat(document.getElementById("expenseAmount").value);
    const expenseDescription = document.getElementById("expenseDescription").value.trim();
    const budgetId = document.getElementById("budgetSelector").value;

    if (!budgetId) {
        alert("‚ùå Please select a budget first.");
        return;
    }

    if (isNaN(expenseAmount) || expenseAmount <= 0 || !expenseDescription) {
        alert("‚ùå Please enter valid expense details.");
        return;
    }

    const currentDate = new Date().toISOString().split('T')[0];  // YYYY-MM-DD format

    const formData = new URLSearchParams();
    formData.append("budget_id", budgetId);
    formData.append("amount", expenseAmount);
    formData.append("description", expenseDescription);
    formData.append("date", currentDate);

    fetch("add_expense.php", {
        method: "POST",
        headers: { "Content-Type": "application/x-www-form-urlencoded" },
        body: formData.toString()
    })
    .then(response => response.json())
    .then(data => {
        alert(data.message);

        if (data.status === "success") {
            fetchBudgetsFromServer();
            fetchTransactions(budgetId);

            document.getElementById("expenseAmount").value = "";
            document.getElementById("expenseDescription").value = "";
        }
    })
    .catch(error => console.error("‚ùå Error adding expense:", error));
}

// ‚úÖ 8. Toggle Previous Budgets & Transactions
function togglePreviousBudgets() {
    const previousBudgetsList = document.getElementById("previousBudgetsList");
    const transactionsList = document.getElementById("transactionsList");
    const budgetId = document.getElementById("budgetSelector").value;

    if (!budgetId) {
        showToast("‚ùå Please select a budget first.", "error");
        return;
    }

    // ‚úÖ Toggle budgets visibility
    budgetsVisible = !budgetsVisible;
    previousBudgetsList.style.display = budgetsVisible ? "block" : "none";

    // ‚úÖ Toggle transactions visibility
    transactionsVisible = !transactionsVisible;

    if (transactionsVisible) {
        fetchTransactions(budgetId);
        transactionsList.style.display = "block";
    } else {
        transactionsList.style.display = "none";
    }
}

// ‚úÖ 9. Fetch Transactions
async // ‚úÖ Fetch and display transactions
function fetchTransactions(budgetId) {
    if (!budgetId) return;

    fetch(`fetch_transactions.php?budget_id=${budgetId}`)
        .then(response => response.json())
        .then(transactions => {
            const transactionsList = document.getElementById("transactionsList");
            transactionsList.innerHTML = "";  // Clear previous transactions

            if (transactions.length === 0) {
                transactionsList.innerHTML = "<p>No transactions found.</p>";
            } else {
                transactions.forEach(transaction => {
                    const transactionDiv = document.createElement("div");
                    transactionDiv.classList.add("transaction-item");

                    // ‚úÖ Use `created_at` as the transaction date
                    transactionDiv.innerHTML = `
                        <p><strong>Amount:</strong> ‚Çπ${transaction.amount}</p>
                        <p><strong>Description:</strong> ${transaction.description}</p>
                        <p><strong>Date:</strong> ${transaction.created_at}</p>
                    `;
                    transactionsList.appendChild(transactionDiv);
                });
            }

            transactionsList.style.display = "block";
        })
        .catch(error => console.error("‚ùå Error fetching transactions:", error));
}


// ‚úÖ 10. Utility Functions
function clearInputs(ids) {
    ids.forEach(id => document.getElementById(id).value = "");
}

function showToast(message, type) {
    const toast = document.createElement("div");
    toast.classList.add("toast", type);
    toast.textContent = message;
    document.body.appendChild(toast);

    setTimeout(() => {
        toast.remove();
    }, 3000);
}


// ‚úÖ Delete Budget

function deleteBudget(budgetId) {
    fetch('delete_budget.php', {
        method: 'POST',
        headers: {
            'Content-Type': 'application/json'
        },
        body: JSON.stringify({ id: budgetId })
    })
    .then(response => response.json())
    .then(data => {
        alert(data.message);
        if (data.status === "success") {
            // Refresh or update your UI
            location.reload();
        }
    })
    .catch(error => {
        console.error('Error:', error);
        alert('‚ùå An error occurred while deleting the budget.');
    });
}


</script>



</body>
</html>
